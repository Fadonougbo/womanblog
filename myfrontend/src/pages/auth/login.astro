---
import Layout from '../../layouts/Layout.astro';
import Arrow from "@lucide/astro/icons/arrow-left"
import { actions } from 'astro:actions';
import type { ApiResponseType } from '../../../types.d.ts';


export const prerender = false;

 const result= Astro.getActionResult(actions.login);

 const data=result?.data as ApiResponseType | undefined

 if(data?.success===true){
    return Astro.redirect('/dashboard')
 }

/* Je n'ai paas afficher le message des erreur zod*/

---

<Layout title='Login'>


    <form class="min-h-screen flex flex-col justify-center" method="post" action={actions.login} >

        <!-- Message pour les erreurs de validation zod -->
        {
           result?.error !== undefined && <p class="text-error text-center my-4" >Une erreur est survenu. veuillez rééssayer</p>
        }


        <!-- Message pour les erreurs de validation serveur -->

        {
           data?.success===false && <p class="text-error text-center my-4" >{data?.message}</p>
        }
        
        <section class="hero">

              <div class="lg:flex-row-reverse flex-col lg:w-2/3 hero-content">

                  <div class="lg:text-left text-center">

                    <h1 class="font-bold text-3xl lg:text-5xl">Connexion</h1>
                    <p class="py-4 max-w-3xl">
                        <strong>
                            <em>« Chaque femme a une histoire. Continue d’écrire la tienne. »</em>
                          </strong>          
                    </p>

                  </div>


                  <div class="shadow-md border-[1px] border-gray-200 w-full max-w-sm card shrink-0">
                    <div class="card-body">

                      <section class="mb-4">

                        <a href="/" class="group flex justify-start items-center hover:underline">
                          <Arrow class='transition-transform group-hover:-translate-x-1.5'/>
                          <strong>Accueil</strong>
                        </a>

                      </section>

                      <fieldset class="fieldset">
                        
                        <section>

                          <label class="label" for="email">Email</label>

                          <input type="email" class="input" name="email" value={`${data?.errors?.email?data?.inputs?.email:''}`} placeholder="awa@gmail.com" id="email" />
                          
                          {data?.errors?.email && <p class="text-error mt-2" >{data?.errors?.email}</p>}

                          </section>

                         <section>

                            <label class="label mt-3" for="password">Mot de passe</label>
                            <input type="password" class="input" name="password" placeholder="Mot de passe" id="password" />

                         </section>

                          <div class="my-2" >
                              <a href="/auth/register" class="link link-hover">Créer un compte ?</a>
                          </div>

                          <button class="mt-4 btn btn-neutral">Je me connecte</button>

                      </fieldset>
                    </div>
                  </div>

              </div>

      </section>  

  </form>

</Layout>
